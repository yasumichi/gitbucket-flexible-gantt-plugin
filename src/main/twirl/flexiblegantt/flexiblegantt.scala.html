@(
    repository: gitbucket.core.service.RepositoryService.RepositoryInfo
)(implicit context: gitbucket.core.controller.Context)
@import context._
@import gitbucket.core.html.main
@import gitbucket.core.admin.html.menu
@import gitbucket.core.helper.html.information
@import gitbucket.core.view.helpers._
@import gitbucket.core.util.Directory._
@gitbucket.core.html.main("Gantt Chart", Some(repository)) {
    @gitbucket.core.html.menu("gantt", repository) {
        <div class="container">
            <svg id="gantt" width="90%" height="90%"></svg>
        </div>
        <script>
            const issuebase = "@context.baseUrl/@repository.owner/@repository.name/issues/";

            function init() {
                const url = "@context.baseUrl/@repository.owner/@repository.name/flexible-gantt/issues";
                fetch(url)
                .then(res => {
                    if (res.ok) {
                        return res.json();
                    }
                })
                .then(data => {
                    const tasks = data.list;
                    var gantt_chart = new Gantt("#gantt", tasks, {
                        on_click: function (task) {
                            window.open(issuebase + task.id)
                        },
                        on_date_change: function(task, start, end) {
                            console.log(task, start, end);
                        },
                        on_progress_change: function(task, progress) {
                            console.log(task, progress);
                        },
                        on_view_change: function(mode) {
                            console.log(mode);
                        },
                        container_height: document.querySelector(".content-wrapper").clientHeight - 150,
                        popup_on: 'hover',
                        view_mode_select: true,
                        language: 'ja'
                    })
                });
            }

            document.addEventListener("DOMContentLoaded", function() {
                init();
            }, false);
        </script>
    }
}
